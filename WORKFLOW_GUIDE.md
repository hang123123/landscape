# 🚄 火车沿途风景 - 完整流程指南

## 🎯 功能流程

### 第一步：查询车次 🔍
**用户操作**：填写始发站、终点站、出发日期

**API调用**：`POST /api/search-trains`
```json
{
  "origin": "北京",
  "destination": "上海", 
  "departure_date": "2024-01-15"
}
```

**AI处理**：百炼大模型根据出行需求，返回多个车次选项

**返回结果**：
```json
{
  "trains": [
    {
      "train_number": "G1",
      "departure_time": "08:00",
      "arrival_time": "12:23",
      "duration": "4小时23分",
      "price": "553元",
      "train_type": "高速动车"
    },
    {
      "train_number": "D311",
      "departure_time": "10:35",
      "arrival_time": "16:48",
      "duration": "6小时13分",
      "price": "428元",
      "train_type": "动车组"
    }
  ]
}
```

### 第二步：获取沿途景点 🏛️
**用户操作**：从车次列表中选择具体车次

**API调用**：`POST /api/get-route-info`
```json
{
  "train_number": "G1",
  "origin": "北京",
  "destination": "上海"
}
```

**AI处理**：百炼大模型分析该车次的沿途路线，推荐各站点的知名景点和特色美食

**返回结果**：
```json
{
  "route_info": {
    "train_no": "G1",
    "from_station": "北京",
    "to_station": "上海",
    "travel_time": "约5小时"
  },
  "attractions": [
    {
      "city": "北京",
      "scenic_spots": ["故宫", "八达岭长城"],
      "local_food": ["北京烤鸭", "炸酱面"],
      "description": "首都历史文化名城，世界文化遗产聚集地"
    },
    {
      "city": "天津", 
      "scenic_spots": ["天津古文化街", "意式风情区"],
      "local_food": ["狗不理包子", "津门小吃"],
      "description": "海河畔的中西合璧之城，美食文化交融"
    }
  ],
  "travel_tips": [
    "建议提前1小时到站候车，预留安检时间",
    "列车供应简餐但选择有限，可自备沿途城市特色速食"
  ]
}
```

### 第三步：页面展示 🎨
**功能**：将AI返回的数据以美观的方式展示在前端页面

**展示内容**：
- 🚄 列车基本信息（车次、时间、路线）
- 🏛️ 沿途城市景点（名称、描述、图片）
- 🍜 地方特色美食（名称、描述、图片）
- 💡 旅行贴士和建议

## 🤖 AI大模型集成详情

### 车次查询提示词
```
请帮我查询{日期}从{起点}到{终点}的火车车次信息。

要求：
1. 列出3-8个不同时间段的车次选项
2. 包含高铁、动车、普通列车等不同类型  
3. 返回JSON格式，包含车次号、时间、价格、车型等信息

请确保返回有效的JSON数组格式。
```

### 景点推荐提示词
```
请为我推荐从{起点}到{终点}的{车次}次列车沿途的风景名胜和特色美食。

要求：
1. 推荐3-5个沿途主要城市或景点
2. 每个地点包括：景点名称、特色美食、简短描述
3. 返回JSON格式，结构化数据

请确保返回有效的JSON格式。
```

## 🛡️ 降级策略

### 无API配置场景
- 自动使用精心设计的模拟数据
- 保证功能完整可用
- 显示提示信息指导配置

### API调用失败场景  
- 智能降级到模拟数据
- 记录错误日志
- 用户无感知的平滑切换

### 响应解析失败场景
- 尝试多种JSON解析方法
- 构建基础数据结构
- 确保页面正常展示

## 📊 数据流程图

```
用户输入 → API第一步 → 百炼大模型 → 车次列表 
    ↓
用户选择车次 → API第二步 → 百炼大模型 → 景点美食推荐
    ↓
前端页面展示 → 用户浏览沿途风景信息
```

## 🎨 前端交互流程

1. **首页输入**：
   - 始发站选择器
   - 终点站选择器  
   - 日期选择器
   - 搜索按钮

2. **车次选择页**：
   - 车次列表展示
   - 时间、价格、车型信息
   - 点击选择车次

3. **景点展示页**：
   - Bento Grid布局
   - 景点图片和描述
   - 美食推荐
   - 旅行贴士

## 🔧 技术架构

### 后端技术栈
- **框架**：FastAPI + Uvicorn
- **AI集成**：阿里百炼 DashScope SDK
- **数据处理**：Pydantic 数据验证
- **异步支持**：asyncio + httpx

### 前端技术栈  
- **样式**：Tailwind CSS 3.0+
- **动画**：Framer Motion (Apple风格)
- **图标**：Font Awesome
- **布局**：Bento Grid设计
- **图片**：Unsplash高质量图片

### AI集成技术
- **调用方式**：Application.call
- **模型**：通义千问系列
- **提示词工程**：结构化JSON输出
- **错误处理**：多层降级机制

## 🚀 快速开始

### 1. 环境配置
```bash
# 安装依赖
pip install -r requirements.txt

# 配置API密钥
cp env.example .env
# 编辑.env填入API_KEY和APP_ID
```

### 2. 启动服务
```bash
python start.py
```

### 3. 访问应用
- 主页：http://localhost:8000
- API文档：http://localhost:8000/docs
- 健康检查：http://localhost:8000/api/health

## 📈 功能特点

✅ **智能推荐**：基于AI大模型的个性化推荐  
✅ **实时查询**：支持任意日期、路线的车次查询  
✅ **沿途风景**：详细的景点和美食信息  
✅ **优雅降级**：无API配置时自动使用模拟数据  
✅ **现代UI**：Apple风格动画和Bento Grid布局  
✅ **响应式设计**：支持桌面和移动端  

## 🎯 扩展功能

### 可扩展方向
- 📅 实时票价查询
- 🏨 沿途酒店推荐  
- 🌤️ 目的地天气信息
- 📱 移动端APP开发
- 🔔 车次延误提醒
- 📸 用户游记分享

---

**🎉 现在您的火车沿途风景推荐系统已经完全按照需求实现了！** 